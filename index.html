<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>2048 Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{ --bg:#faf8ef; --board:#bbada0; --tile-bg:#cdc1b4; --tile-color:#776e65; --size:4; }
  body{ margin:0; font-family:Inter,sans-serif; background:var(--bg); display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding:40px 20px; }
  .container{ width:520px; max-width:95vw; }
  header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
  h1{ margin:0; font-size:22px; color:#776e65;}
  .controls{ display:flex; gap:8px; align-items:center;}
  .scorebox{ background:#eee4da; color:#776e65; padding:8px 12px; border-radius:6px; font-weight:700; }
  button{ background:#8f7a66; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:600; }
  #game-area{ background:var(--board); padding:16px; border-radius:10px; position:relative; box-shadow:0 8px 18px rgba(0,0,0,0.12); }
  .grid{ display:grid; gap:12px; background:transparent; padding:12px; border-radius:8px; justify-content:center; }
  .cell{ width:100px; height:100px; border-radius:6px; background:var(--tile-bg); display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:700; color:var(--tile-color); box-shadow:inset 0 -4px 0 rgba(0,0,0,0.06);}
  .tile-0{ background:#cdc1b4; color:transparent; font-weight:400;}
  .tile-2{ background:#eee4da; color:#776e65;}
  .tile-4{ background:#ede0c8; color:#776e65;}
  .tile-8{ background:#f2b179; color:#f9f6f2;}
  .tile-16{ background:#f59563; color:#f9f6f2;}
  .tile-32{ background:#f67c5f; color:#f9f6f2;}
  .tile-64{ background:#f65e3b; color:#f9f6f2;}
  .tile-128{ background:#edcf72; color:#f9f6f2; font-size:20px;}
  .tile-256{ background:#edcc61; color:#f9f6f2; font-size:20px;}
  .tile-512{ background:#edc850; color:#f9f6f2; font-size:20px;}
  .tile-1024{ background:#edc53f; color:#f9f6f2; font-size:18px;}
  .tile-2048{ background:#edc22e; color:#f9f6f2; font-size:18px;}
  .message{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(238,232,214,0.9); border-radius:10px; z-index:20; flex-direction:column; gap:12px; font-size:20px; font-weight:700; color:#776e65; }
  .small{ font-size:14px; font-weight:500; color:#6b6158; }
  .arrow-controls{ margin-top:12px; display:flex; gap:8px; justify-content:center;}
  .direction-btn{ width:44px; height:44px; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; background:#e0d6cc; color:#5a4f45; border:none; cursor:pointer; font-weight:700;}
  .footer-note{ margin-top:12px; color:#6b6158; font-size:13px; text-align:center; }
  @media (max-width:520px){ .cell{ width:58px; height:58px; font-size:16px;} .grid{ gap:8px; padding:8px;} }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>2048 (Plain JS)</h1>
    <div class="controls">
      <div id="score" class="scorebox">Score: 0</div>
      <button id="restart-btn">Restart</button>
    </div>
  </header>
  <div id="game-area">
    <div id="grid-root" class="grid" style="--size:4;"></div>
    <div id="overlay" class="message" style="display:none">
      <div id="overlay-title">You win!</div>
      <div id="overlay-sub" class="small">Press Restart to play again</div>
      <div><button id="overlay-restart">Restart</button></div>
    </div>
  </div>
  <div class="arrow-controls">
    <button class="direction-btn" data-dir="up">‚Üë</button>
    <button class="direction-btn" data-dir="left">‚Üê</button>
    <button class="direction-btn" data-dir="down">‚Üì</button>
    <button class="direction-btn" data-dir="right">‚Üí</button>
  </div>
  <p class="footer-note">Use keyboard arrows or buttons. Board size configurable inside the JS (variable `SIZE`).</p>
</div>

<script>
const game2048 = (function() {
  return {
    SIZE: 4, TARGET: 2048, PROBABILITY_4:0.1,
    state:{ board:null, score:0, won:false, over:false },
    emptyCells:[], maxTile:0,
    gridRoot: document.getElementById('grid-root'),
    scoreEl: document.getElementById('score'),
    overlay: document.getElementById('overlay'),
    overlayTitle: document.getElementById('overlay-title'),
    overlaySub: document.getElementById('overlay-sub'),

    init:function(){
      this.startNewGame();
      this.addEventListeners();
    },

    createEmptyBoard:function(n){ return Array.from({length:n},()=>Array(n).fill(0)); },
    cloneBoard:function(board){ return board.map(r=>r.slice()); },
    updateEmptyCells:function(){
      this.emptyCells=[];
      for(let r=0;r<this.SIZE;r++)
        for(let c=0;c<this.SIZE;c++)
          if(this.state.board[r][c]===0) this.emptyCells.push([r,c]);
    },
    addRandomTile:function(){
      if(!this.emptyCells.length) return;
      const idx=Math.floor(Math.random()*this.emptyCells.length);
      const [r,c]=this.emptyCells[idx];
      const v=Math.random()<this.PROBABILITY_4?4:2;
      this.state.board[r][c]=v;
      this.emptyCells.splice(idx,1);
      if(v>this.maxTile) this.maxTile=v;
    },
    transpose:function(board){
      const n=board.length; const nb=this.createEmptyBoard(n);
      for(let r=0;r<n;r++) for(let c=0;c<n;c++) nb[c][r]=board[r][c];
      return nb;
    },
    reverseRows:function(board){ return board.map(r=>r.slice().reverse()); },
    mergeRowLeft:function(row){
      let newRow=Array(this.SIZE).fill(0),scoreGain=0,pos=0,last=-1;
      for(let i=0;i<this.SIZE;i++){
        if(row[i]===0) continue;
        if(last===row[i]){
          newRow[pos-1]*=2; scoreGain+=newRow[pos-1]; if(newRow[pos-1]>this.maxTile) this.maxTile=newRow[pos-1]; last=-1;
        } else { newRow[pos++]=row[i]; last=row[i]; }
      }
      return {row:newRow,scoreGain};
    },
    moveLeft:function(board){
      let newBoard=this.createEmptyBoard(this.SIZE),moved=false,totalGain=0;
      for(let r=0;r<this.SIZE;r++){
        const {row:mergedRow,scoreGain}=this.mergeRowLeft(board[r]);
        totalGain+=scoreGain; newBoard[r]=mergedRow;
        if(!moved && mergedRow.join(',')!==board[r].join(',')) moved=true;
      }
      return {board:newBoard,moved,scoreGain:totalGain};
    },
    moveRight:function(board){ const reversed=this.reverseRows(board); const res=this.moveLeft(reversed); return {board:this.reverseRows(res.board),moved:res.moved,scoreGain:res.scoreGain}; },
    moveUp:function(board){ const trans=this.transpose(board); const res=this.moveLeft(trans); return {board:this.transpose(res.board),moved:res.moved,scoreGain:res.scoreGain}; },
    moveDown:function(board){ const trans=this.transpose(board); const res=this.moveRight(trans); return {board:this.transpose(res.board),moved:res.moved,scoreGain:res.scoreGain}; },
    checkWin:function(){ return this.maxTile>=this.TARGET; },
    hasMoves:function(){ if(this.emptyCells.length>0) return true; const n=this.SIZE; const b=this.state.board; for(let r=0;r<n;r++) for(let c=0;c<n-1;c++){ if(b[r][c]===b[r][c+1]) return true; if(b[c][r]===b[c+1][r]) return true; } return false; },
    renderBoard:function(){ this.gridRoot.style.gridTemplateColumns=`repeat(${this.SIZE},1fr)`; this.gridRoot.innerHTML=''; for(let r=0;r<this.SIZE;r++) for(let c=0;c<this.SIZE;c++){ const v=this.state.board[r][c]; const cell=document.createElement('div'); cell.className='cell tile-'+v; cell.textContent=v===0?'':v; this.gridRoot.appendChild(cell);} this.scoreEl.textContent='Score: '+this.state.score; },
    showOverlay:function(title,sub){ this.overlayTitle.textContent=title; this.overlaySub.textContent=sub||''; this.overlay.style.display='flex'; },
    hideOverlay:function(){ this.overlay.style.display='none'; },

    startNewGame:function(){
      this.state.board=this.createEmptyBoard(this.SIZE);
      this.state.score=0; this.state.won=false; this.state.over=false;
      this.maxTile=0; this.updateEmptyCells();
      this.addRandomTile(); this.addRandomTile();
      this.updateEmptyCells();
      this.hideOverlay();
      this.renderBoard();
    },

    performMove:function(direction){
      if(this.state.over) return;
      let result;
      if(direction==='left') result=this.moveLeft(this.state.board);
      else if(direction==='right') result=this.moveRight(this.state.board);
      else if(direction==='up') result=this.moveUp(this.state.board);
      else if(direction==='down') result=this.moveDown(this.state.board);
      else return;
      if(result.moved){
        this.state.board=result.board; this.state.score+=result.scoreGain;
        this.updateEmptyCells(); this.addRandomTile();
        if(!this.state.won && this.checkWin()){ this.state.won=true; this.renderBoard(); this.showOverlay('You reached 2048!','üéâ Press Restart or keep playing'); }
        if(!this.hasMoves()){ this.state.over=true; this.renderBoard(); this.showOverlay('Game Over','No more moves. Press Restart to try again.'); return; }
        this.renderBoard();
      }
    },

    getState:function(){ return JSON.parse(JSON.stringify(this.state)); },

    addEventListeners:function(){
      document.querySelectorAll('.direction-btn').forEach(btn=>btn.addEventListener('click',()=>this.performMove(btn.dataset.dir)));
      document.getElementById('restart-btn').addEventListener('click',()=>this.startNewGame());
      document.getElementById('overlay-restart').addEventListener('click',()=>this.startNewGame());
      document.addEventListener('keydown',e=>{
        if(e.key==='ArrowLeft') this.performMove('left');
        else if(e.key==='ArrowRight') this.performMove('right');
        else if(e.key==='ArrowUp') this.performMove('up');
        else if(e.key==='ArrowDown') this.performMove('down');
      });
    }
  };
})();

document.addEventListener('DOMContentLoaded',()=>{ window.game2048=game2048; game2048.init(); });
</script>
</body>
</html>
